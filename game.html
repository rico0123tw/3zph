<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æ°´æœæ¥æ¥æ¨‚ - é—œå¡ç‰ˆ</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #000;
      font-family: sans-serif;
    }
    #gameCanvas {
      display: block;
      margin: auto;
      border: 2px solid #333;
    }
    #score {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: bold;
      color: #fff;
    }
    #restartBtn {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 20px;
      padding: 8px 16px;
      display: none;
    }
  </style>
</head>
<body>
  <div id="score">åˆ†æ•¸: 0</div>
  <button id="restartBtn">é‡æ–°é–‹å§‹</button>
  <canvas id="gameCanvas" width="500" height="600"></canvas>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const scoreDisplay = document.getElementById("score");
    const restartBtn = document.getElementById("restartBtn");

    // èƒŒæ™¯åœ–ç‰‡
    const bgImg = new Image();
    bgImg.src = "è—¥å±€.png";

    // ç©å®¶è§’è‰²åœ–ç‰‡
    const playerImg = new Image();
    playerImg.src = "è§’è‰².png";

    // æ°´æœåœ–ç‰‡è¼‰å…¥
    const fruitImgs = {
      "ğŸ": { img: new Image(), score: 1 },
      "ğŸŒ": { img: new Image(), score: 2 },
      "ğŸŠ": { img: new Image(), score: 3 },
      "ğŸ“": { img: new Image(), score: 5 },
      "ğŸ‰": { img: new Image(), bad: true }
    };
    fruitImgs["ğŸ"].img.src = "apple.png";
    fruitImgs["ğŸŒ"].img.src = "banana.png";
    fruitImgs["ğŸŠ"].img.src = "orange.png";
    fruitImgs["ğŸ“"].img.src = "strawberry.png";
    fruitImgs["ğŸ‰"].img.src = "watermelon.png";

    const fruits = ["ğŸ","ğŸŒ","ğŸŠ","ğŸ“"];
    let player, items, score, gameOver, mouseX, combo, spawnInterval;
    let level, fruitCount, speedMultiplier, watermelonChance;
    let paused = true; // éŠæˆ²ä¸€é–‹å§‹æš«åœ
    const catchRadius = 30; // åˆ¤å®šåŠå¾‘
    const maxLevel = 10;
    const fruitsPerLevel = 30;

    function initGame() {
      player = { 
        x: canvas.width/2 - 60, 
        y: canvas.height - canvas.height/4 - 20, 
        width: canvas.height/4 * 0.75, 
        height: canvas.height/4 
      };
      items = [];
      score = 0;
      combo = 0;
      gameOver = false;
      level = 1;
      fruitCount = 0;
      speedMultiplier = 1;
      watermelonChance = 0.2; // åˆå§‹è¥¿ç“œæ©Ÿç‡
      scoreDisplay.textContent = "åˆ†æ•¸: 0 | ç¬¬ 1 é—œ";
      restartBtn.style.display = "none";
      mouseX = player.x;

      clearInterval(spawnInterval);
      spawnInterval = setInterval(spawnItem, 1000);

      paused = true; // ä¸€é–‹å§‹æš«åœ
      update();
    }

    // æ»‘é¼ æ§åˆ¶
    canvas.addEventListener("mousemove", e => {
      const rect = canvas.getBoundingClientRect();
      mouseX = e.clientX - rect.left - player.width / 2;
    });

    // æ»‘é¼ é»æ“Šåˆ‡æ›æš«åœ/ç¹¼çºŒ
    canvas.addEventListener("click", () => {
      if (gameOver) return;
      paused = !paused;
      if (!paused) {
        update();
      }
    });

    function spawnItem() {
      if (gameOver || paused) return;
      const isBad = Math.random() < watermelonChance;
      const fruitKey = isBad ? "ğŸ‰" : fruits[Math.floor(Math.random() * fruits.length)];
      items.push({
        x: Math.random() * (canvas.width - 60),
        y: -60,
        key: fruitKey,
        bad: isBad
      });
    }

    function update() {
      if (gameOver) return;
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // ç•«èƒŒæ™¯ + èª¿æš—æ•ˆæœ
      ctx.drawImage(bgImg, 0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "rgba(0,0,0,0.4)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // ç©å®¶ä½ç½®å¹³æ»‘è·Ÿéš¨æ»‘é¼ 
      player.x += (mouseX - player.x) * 0.1;
      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);

      if (paused) {
        // æš«åœç•«é¢é¡¯ç¤ºè¦å‰‡
        ctx.fillStyle = "rgba(0,0,0,0.7)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = "#fff";
        ctx.font = "20px sans-serif";
        ctx.textAlign = "center";
        ctx.fillText("éŠæˆ²æš«åœ", canvas.width/2, canvas.height/2 - 60);
        ctx.fillText("è¦å‰‡ï¼š", canvas.width/2, canvas.height/2 - 30);
        ctx.fillText("æ¯é—œéœ€æ¥åˆ° 30 é¡†æ°´æœ (è¥¿ç“œä¸ç®—)", canvas.width/2, canvas.height/2);
        ctx.fillText("æ¯éä¸€é—œè¥¿ç“œæ©Ÿç‡å¢åŠ  1.1 å€", canvas.width/2, canvas.height/2 + 30);
        ctx.fillText("é»æ“Šæ»‘é¼ ç¹¼çºŒéŠæˆ²", canvas.width/2, canvas.height/2 + 60);
        return; // ä¸æ›´æ–°éŠæˆ²ç‰©ä»¶
      }

      // æ›´æ–°æ°´æœ
      items.forEach(item => {
        item.y += Math.min(10 * speedMultiplier, (4 + score * 0.05) * speedMultiplier);

        const fruitData = fruitImgs[item.key];
        ctx.drawImage(fruitData.img, item.x, item.y, 60, 60); // æ”¾å¤§å…©å€

        // ç¢°æ’æª¢æ¸¬ (ä¸­å¿ƒé»åˆ¤å®š)
        const playerCenterX = player.x + player.width / 2;
        const playerCenterY = player.y + player.height / 2;
        const fruitCenterX = item.x + 30;
        const fruitCenterY = item.y + 30;

        const dx = playerCenterX - fruitCenterX;
        const dy = playerCenterY - fruitCenterY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < catchRadius) {
          if (item.bad) {
            endGame();
          } else {
            score += fruitData.score;
            combo++;
            fruitCount++;
            if (combo % 3 === 0) {
              score += 5; // comboåŠ åˆ†
            }
            scoreDisplay.textContent = "åˆ†æ•¸: " + score + " | ç¬¬ " + level + " é—œ (Combo: " + combo + ")";
          }
          item.y = canvas.height + 100; // ç§»é™¤
        }
      });

      // ç§»é™¤è¶…å‡ºç•«é¢æ°´æœ
      items = items.filter(item => item.y < canvas.height + 50);

      // æª¢æŸ¥æ˜¯å¦éé—œ
      if (fruitCount >= fruitsPerLevel) {
        if (level < maxLevel) {
          level++;
          fruitCount = 0;
          speedMultiplier *= 1.1; // é€Ÿåº¦éå¢
          watermelonChance *= 1.1; // è¥¿ç“œæ©Ÿç‡å¢åŠ 
          scoreDisplay.textContent = "åˆ†æ•¸: " + score + " | ç¬¬ " + level + " é—œ";
          paused = true; // éé—œå¾Œæš«åœé¡¯ç¤ºè¦å‰‡
        } else {
          endGame();
        }
      }

      requestAnimationFrame(update);
    }

        function endGame() {
      gameOver = true;
      ctx.fillStyle = "rgba(0,0,0,0.7)";
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = "#fff";
      ctx.font = "28px sans-serif";
      ctx.textAlign = "center";
      ctx.fillText("éŠæˆ²çµæŸ! æœ€çµ‚åˆ†æ•¸: " + score, canvas.width/2, canvas.height/2 - 20);
      ctx.fillText("å¤šåƒæ°´æœ, ä¸‰èŠè—¥å¸«è—¥å±€é—œå¿ƒæ‚¨", canvas.width/2, canvas.height/2 + 20);
      restartBtn.style.display = "block";
    }

    restartBtn.addEventListener("click", initGame);

    // å•Ÿå‹•éŠæˆ²
    initGame();
  </script>
</body>
</html>
